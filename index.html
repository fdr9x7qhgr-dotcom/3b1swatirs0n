<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğğ ğ‚ğ€ğ‘ğ“ğğ…ğ„ğ‹ ğ…ğ‘ğˆğ“ğ„</title>
    <link rel="apple-touch-icon" sizes="180x180" href="E35874EE-0FD8-4871-BFBA-B35ED03A05B6.png">
    <link rel="icon" type="image/png" sizes="512x512" href="E35874EE-0FD8-4871-BFBA-B35ED03A05B6.png">
    <style>
        body { font-family: Arial; direction: rtl; text-align: center; padding: 10px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th, td { border: 1px solid #333; padding: 6px; }
        .paid { background-color: #c8f7c5; }
        .unpaid { background-color: #f7c5c5; }
        .action-btn { width: auto; padding: 5px 8px; margin: 2px; font-size: 13px; cursor: pointer; }
        /* Ù‚Ø§Ø¦Ù…Ø© Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø· */
        #menuDropdown button { width: 100%; margin: 3px 0; }
    </style>
</head>
<body>

<h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø· -->
<div style="position: fixed; top: 10px; left: 10px; z-index: 1000;">
  <button id="menuBtn" style="font-size: 20px; padding: 5px 10px; cursor: pointer;">â‹®</button>
  <div id="menuDropdown" style="display: none; position: absolute; left: 0; background: #fff; border: 1px solid #333; padding: 5px; text-align: left;">
    <button id="backupBtn" class="action-btn">Backup</button><br>
    <button id="restoreBtn" class="action-btn">Restore</button>
  </div>
</div>

<label>Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…:</label>
<input type="date" id="datePicker">

<input id="shop" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
<input id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input id="pricePerKg" placeholder="Ø«Ù…Ù†/ÙƒÙŠÙ„Ùˆ">
<input id="totalPrice" placeholder="Ø§Ù„Ø«Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø£Ø¯Ø§Ø¤Ù‡" readonly>
<input id="paid" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹">
<input id="remaining" placeholder="Ø§Ù„Ø¨Ø§Ù‚ÙŠ" readonly>
<input id="status" placeholder="Ø® / Ù…">

<button id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>
<button onclick="clearData()">Ù…Ø³Ø­ Ø§Ù„ÙŠÙˆÙ…</button>

<table>
<thead>
<tr>
<th>Ø§Ù„Ù…Ø­Ù„</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø«Ù…Ù†/ÙƒÙŠÙ„Ùˆ</th>
<th>Ø§Ù„Ø«Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨</th>
<th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
<th>Ø§Ù„Ø¨Ø§Ù‚ÙŠ</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
let editIndex = null;
let currentDate = getToday();
document.getElementById("datePicker").value = currentDate;

// ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
document.getElementById("datePicker").addEventListener("change", () => {
    currentDate = document.getElementById("datePicker").value;
    editIndex = null;
    document.getElementById("addBtn").innerText = "Ø¥Ø¶Ø§ÙØ©";
    renderTable();
});

// LocalStorage
function getData() {
    const raw = localStorage.getItem("table_" + currentDate);
    return raw ? JSON.parse(raw) : [];
}
function saveData(data) {
    localStorage.setItem("table_" + currentDate, JSON.stringify(data));
}

// Ø§Ù„ØªØ§Ø±ÙŠØ®
function getToday() {
    const d = new Date();
    return d.toISOString().split('T')[0];
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
function updateTotal() {
    const qty = parseFloat(document.getElementById("qty").value) || 0;
    const pricePerKg = parseFloat(document.getElementById("pricePerKg").value) || 0;
    const totalPrice = qty * pricePerKg;
    document.getElementById("totalPrice").value = totalPrice.toFixed(2);
    updateRemaining();
}
function updateRemaining() {
    const totalPrice = parseFloat(document.getElementById("totalPrice").value) || 0;
    const paid = parseFloat(document.getElementById("paid").value) || 0;
    const remaining = totalPrice - paid;
    document.getElementById("remaining").value = remaining.toFixed(2);
    document.getElementById("status").value = remaining <= 0 ? "Ø®" : "Ù…";
}
document.getElementById("qty").addEventListener("input", updateTotal);
document.getElementById("pricePerKg").addEventListener("input", updateTotal);
document.getElementById("paid").addEventListener("input", updateRemaining);

function getStatus(input) {
    if (input === "Ø®") return { text: "Ø®Ø§Ù„Øµ", className: "paid" };
    if (input === "Ù…") return { text: "Ù…Ø®Ù„ØµØ´", className: "unpaid" };
    return { text: input, className: "" };
}

function renderTable() {
    const table = document.getElementById("tableBody");
    table.innerHTML = "";
    const data = getData();
    data.forEach((row, index) => {
        const tr = document.createElement("tr");
        tr.className = row.className;
        tr.innerHTML = `
            <td>${row.shop}</td>
            <td>${row.qty}</td>
            <td>${row.pricePerKg}</td>
            <td>${row.totalPrice}</td>
            <td>${row.paid}</td>
            <td>${row.remaining}</td>
            <td>${row.status}</td>
            <td>
                <button class="action-btn" onclick="editRow(${index})">ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="action-btn" onclick="deleteRow(${index})">Ø­Ø°Ù</button>
            </td>
        `;
        table.appendChild(tr);
    });
}

function addOrUpdate() {
    const shop = document.getElementById("shop").value.trim();
    const qty = parseFloat(document.getElementById("qty").value) || 0;
    const pricePerKg = parseFloat(document.getElementById("pricePerKg").value) || 0;
    const totalPrice = parseFloat(document.getElementById("totalPrice").value) || 0;
    const paid = parseFloat(document.getElementById("paid").value) || 0;
    const remaining = parseFloat(document.getElementById("remaining").value) || 0;
    const statusInput = document.getElementById("status").value.trim();
    if (!shop) { alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„"); return; }
    const statusData = getStatus(statusInput);
    const rowData = { shop, qty, pricePerKg, totalPrice, paid, remaining, status: statusData.text, className: statusData.className };
    const data = getData();
    if (editIndex === null) { data.push(rowData); }
    else { data[editIndex] = rowData; editIndex = null; document.getElementById("addBtn").innerText = "Ø¥Ø¶Ø§ÙØ©"; }
    saveData(data);
    renderTable();
    document.querySelectorAll("input").forEach(i => i.value = "");
}
function editRow(index) {
    const data = getData();
    const row = data[index];
    document.getElementById("shop").value = row.shop;
    document.getElementById("qty").value = row.qty;
    document.getElementById("pricePerKg").value = row.pricePerKg;
    document.getElementById("totalPrice").value = row.totalPrice;
    document.getElementById("paid").value = row.paid;
    document.getElementById("remaining").value = row.remaining;
    document.getElementById("status").value = row.status;
    editIndex = index;
    document.getElementById("addBtn").innerText = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
}
function deleteRow(index) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
        const data = getData();
        data.splice(index, 1);
        saveData(data);
        renderTable();
    }
}
function clearData() {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ø¯ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ")) {
        saveData([]);
        renderTable();
    }
}

document.getElementById("addBtn").addEventListener("click", addOrUpdate);
renderTable();

// Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø·
document.getElementById("menuBtn").addEventListener("click", () => {
    const menu = document.getElementById("menuDropdown");
    menu.style.display = menu.style.display === "none" ? "block" : "none";
});

// Backup
document.getElementById("backupBtn").addEventListener("click", () => {
    const data = getData();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `backup_${currentDate}.json`;
    a.click();
    URL.revokeObjectURL(url);
    alert("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
});

// Restore
document.getElementById("restoreBtn").addEventListener("click", () => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = ".json";
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = event => {
            try {
                const restoredData = JSON.parse(event.target.result);
                saveData(restoredData);
                renderTable();
                alert("ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            } catch {
                alert("Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­");
            }
        };
        reader.readAsText(file);
    };
    input.click();
});
</script>

</body>
</html>


