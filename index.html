<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>جدول المحلات</title>

<style>
body { font-family: Arial; direction: rtl; text-align: center; padding: 10px; }
input, select, button { width: 100%; padding: 8px; margin: 4px 0; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #333; padding:5px; }
.paid { background:#c8f7c5; }
.unpaid { background:#f7c5c5; }
</style>
</head>

<body>

<h3>نظام حساب المحلات</h3>

<!-- إدارة المحلات -->
<h4>إدارة المحلات</h4>

<input id="newShopName" placeholder="اسم المحل الجديد">
<input id="newShopDebt" placeholder="الباقي الأولي">

<button onclick="addShop()">➕ إضافة محل</button>
<button onclick="deleteShop()">❌ مسح المحل</button>

<hr>

<!-- اختيار المحل -->
<select id="shopSelect" onchange="loadOldDebt()">
<option value="">اختر المحل</option>
</select>

<input id="oldDebt" placeholder="الباقي القديم" readonly>
<input id="qty" placeholder="الكمية">
<input id="price" placeholder="ثمن/كيلو">

<input id="total" placeholder="الثمن الواجب" readonly>
<input id="paid" placeholder="المدفوع">

<input id="newDebt" placeholder="الباقي الجديد" readonly>
<input id="sumDebt" placeholder="مجموع الباقي" readonly>

<button onclick="addRecord()">إضافة للجدول</button>

<!-- الجدول -->
<table>
<thead>
<tr>
<th>المحل</th>
<th>الواجب</th>
<th>المدفوع</th>
<th>الباقي الجديد</th>
<th>مجموع الباقي</th>
</tr>
</thead>

<tbody id="table"></tbody>
</table>

<script>

// المحلات
let shops = JSON.parse(localStorage.getItem("shops")||"{}");
let records = JSON.parse(localStorage.getItem("records")||"[]");

function save(){
localStorage.setItem("shops",JSON.stringify(shops));
localStorage.setItem("records",JSON.stringify(records));
}

// تحميل اللائحة
function loadShops(){
let s=document.getElementById("shopSelect");
s.innerHTML='<option value="">اختر المحل</option>';

for(let k in shops){
let o=document.createElement("option");
o.value=k;
o.textContent=k;
s.appendChild(o);
}
}
loadShops();

// إضافة محل
function addShop(){
let name=document.getElementById("newShopName").value.trim();
let debt=parseFloat(document.getElementById("newShopDebt").value)||0;

if(!name){alert("اكتب اسم المحل");return;}

shops[name]=debt;
save();
loadShops();

document.getElementById("newShopName").value="";
document.getElementById("newShopDebt").value="";
}

// حذف محل
function deleteShop(){
let s=document.getElementById("shopSelect").value;

if(!s){alert("اختر محل");return;}

if(confirm("مسح المحل؟")){
delete shops[s];
save();
loadShops();
}
}

// تحميل الباقي القديم
function loadOldDebt(){
let s=document.getElementById("shopSelect").value;
document.getElementById("oldDebt").value=shops[s]||0;
calc();
}

// الحساب
function calc(){
let q=parseFloat(qty.value)||0;
let p=parseFloat(price.value)||0;
let pay=parseFloat(paid.value)||0;
let old=parseFloat(oldDebt.value)||0;

let total=q*p;
let newD=total-pay;
let sum=old+newD;

totalInput.value=total.toFixed(2);
newDebt.value=newD.toFixed(2);
sumDebt.value=sum.toFixed(2);
}

let qty=document.getElementById("qty");
let price=document.getElementById("price");
let paid=document.getElementById("paid");
let oldDebt=document.getElementById("oldDebt");

let totalInput=document.getElementById("total");
let newDebt=document.getElementById("newDebt");
let sumDebt=document.getElementById("sumDebt");

qty.oninput=price.oninput=paid.oninput=calc;

// إضافة للسجل
function addRecord(){

let shop=shopSelect.value;
if(!shop){alert("اختر محل");return;}

let total=+totalInput.value;
let pay=+paid.value;
let newD=+newDebt.value;
let sum=+sumDebt.value;

records.push({
shop,total,pay,newD,sum
});

// تحديث دين المحل
shops[shop]=sum;

save();
render();
loadOldDebt();

qty.value=price.value=paid.value="";
}

// عرض الجدول
function render(){

let t=document.getElementById("table");
t.innerHTML="";

records.forEach(r=>{

let tr=document.createElement("tr");
tr.innerHTML=`
<td>${r.shop}</td>
<td>${r.total}</td>
<td>${r.pay}</td>
<td>${r.newD}</td>
<td>${r.sum}</td>
`;

t.appendChild(tr);

});
}
render();

</script>

</body>
</html>
